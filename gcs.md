# Security Hardening Guidelines - Google Cloud Storage

This document describes the security requirements involved in performing service enablement for GCS.
The requirements have been derived from various sources, like:
- Customer Security Standards 
- Google Recommended Security Best Practices 


## Purpose
This is an exhaustive list of requirements which will be reviewed by security reviewers at [Customer]. 
<br>Once finalized, the appropriate security controls will be enforced through the best and most suitable choice out of terraform, organization policies, sentinel policies, etc. 

The existing terraform modules for GCS will be reviewed to ensure that they're in sync with these best practices. 
After that, any application level configuration that needs to be made by the application teams while consuming those terraform modules would be put together in a guide.

**Note:** This document consists of the reviewed and finalized security hardening requirements for GCS from the [master list](https://docs.google.com/spreadsheets/d/1nGqVZ_JRQJvYALRrNKvt28KpC01CEn0vwA7gk0NM1Ww/edit#gid=1771890796). It will be updated with status and links to implementation after further reviews.

Here's what a control status means:

| Status Type  	| Meaning                                                                                           	|
|--------------	|---------------------------------------------------------------------------------------------------	|
| Enforced     	| This security control is enforced. A reference to the enforcing control is linked.                	|
| Not Enforced 	| This security requirement is currently not enforced. A security control has to be built for this. 	|
| TBD          	| This may or may not be enforced. Additional information is needed from reviewers.             	|
| NA          	| This is not relevant or is addressed elsewhere            	                                        |

## Usage and target audience

**Target audience**: Application teams that need to ensure they're meeting the security requirements for their GCP cloud resources.

**Usage**: Application teams should ensure that they're using the correct terraform module which is geared towards being secure. Additionally, in places where security controls are not being enforced by the Terraform module, they should ensure they have the correct security control in place. 


## Authors
- [Saad Ahmad](saadx@google.com)
  
## Reviewers

- [Saad Ahmad](saadx@google.com)
                                                                                                                                                           
## Security Standards for GCS
|    ID   	| Status of Enforcement 	|                                                                                                                                                                                                                                                                                                                                                                                                         Security Requirements                                                                                                                                                                                                                                                                                                                                                                                                         	|                                                                                  Condition                                                                                 	|                                                                                                                                                                                                Rationale                                                                                                                                                                                               	| Link to  Implementation 	|
|:-------:	|:---------------------:	|:-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:	|:--------------------------------------------------------------------------------------------------------------------------------------------------------------------------:	|:------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------:	|:-----------------------:	|
| GCS-001 	|          TBD          	| Assign a lifecycle management configuration to a bucket. The configuration contains a set of rules which apply to current and future objects in the bucket. When an object meets the criteria of one of the rules, Cloud Storage automatically performs a specified action on the object. Here are some example use cases:  <br> 1. Downgrade the storage class of objects older than 365 days to Coldline Storage. <br> 2. Delete objects created before say January 1, 2013. <br> 3. Keep only the 3 most recent versions of each object in a bucket with versioning enabled. <br><br>**References:** <br>[Configure GCS Data Lifecycle Policy](https://cloud.google.com/storage/docs/lifecycle) <br><br>**Related Compliance Standards**: CIS Critical Controls v8 3.1,  <br> CIS Critical Controls v8 3.5,  <br> PCI DSS v4 3.2.1 	| Are data lifecycle policies configured for GCS buckets?                                                                                                                    	| Ensures that data older than necessary is no longer retained, reducing the opportunity for unintended data loss.  Ensure a Data Lifecycle Policy is configured for all Buckets.                                                                                                                                                                                                                        	|           TBD           	|
| GCS-002 	|          TBD          	| Periodically review data locality with respect to data locality requirements. <br> If strict data locality or residency requirements exist, the Organization Policy,  Restricting Resource Locations can be enabled to restrict operations to a particular region set.   https://cloud.google.com/resource-manager/docs/organization-policy/defining-locations <br><br>**References:** <br>[Review locations of where data is stored](https://cloud.google.com/storage/docs/locations) <br><br>**Related Compliance Standards**: <br>CIS Critical Controls v8 3.2                                                                                                                                                                                                                                                                     	| Which regions or regions is your data stored in?  Does this meet data compliance requirements?                                                                             	| Reviewing the location of where your data is stored in Google Cloud Storage helps to ensure compliance with regards to data residency.                                                                                                                                                                                                                                                                 	|           TBD           	|
| GCS-003 	|          TBD          	| Storage bucket logging helps maintain an audit trail of access  that can be used in the event of a security incident.<br>Bucket Logging can only be enabled by using the Command Line Interface and the log bucket must already be created.  Use this command to enable Logging:  `gsutil logging set on -b gs://[LOG_BUCKET_NAME] -o AccessLog \ gs://[BUCKET_NAME]', // eslint-disable-line no-useless-escape` <br><br>**References:** <br>[Reference 1](https://cloud.google.com/storage/docs/audit-logging) <br>[Reference 2](https://cloud.google.com/storage/docs/gsutil/commands/logging) <br><br>**Related Compliance Standards:** <br>CIS Critical Controls v8 3.14                                                                                                                                                          	| Do you have logging enabled for your storage buckets?                                                                                                                      	| Storage bucket logging helps maintain an audit trail of access that can be used in the event of a security incident.                                                                                                                                                                                                                                                                                   	|           TBD           	|
| GCS-004 	|          TBD          	| Ensure Buckets and Objects are encrypted with CMEK when required to maintain management over the encryption keys. <br>**References:**<br> <br>[CMEK](https://cloud.google.com/storage/docs/encryption/customer-managed-key) <br>**Related Compliance Standards:** <br>CIS Critical Controls v8 3.14 <br> PCI DSS v4 3.5.1                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             	| Does your organization require you to have control over encryption keys used to encrypt data stored in Google managed services? (ie. using Custom Managed Encryption Keys) 	| If your security requirements mandate the use of customer-managed encryption keys to encrypt data stored in Google Cloud,  use CMEK in place of Google default encryption.  Using a KMS key for Bucket Encryption ensures that the keys can be managed/audited/rotated by the customer                                                                                                                 	|           TBD           	|
| GCS-005 	|          TBD          	| Choose bucket and object names that are difficult to guess and avoid the use of sensitive information as part of bucket or object names.  In some applications, you may want to keep sensitive metadata in custom Cloud Storage headers such as x-goog-meta, rather than encoding the metadata in object names. <br><br>**References:** <br>[Bucket and Object names](https://cloud.google.com/storage/docs/buckets#naming) <br><br>**Related Compliance Standards:** <br>CIS Critical Controls v8 3.1                                                                                                                                                                                                                                                                                                                                	| Do you follow a naming convention for buckets and objects which avoids the use of sensitive information and is difficult to guess?                                         	| Cloud Storage requests refer to buckets and objects by their names.  As a result, even though ACLs will prevent unauthorized third parties from operating on buckets or objects, a third party can  attempt requests with bucket or object names and determine their existence by observing the error responses.  It can then be possible for information in bucket or object names to be leaked.      	|           TBD           	|
| GCS-007 	|          TBD          	| Ensure that you use dual-region or multi-region buckets to create redundancy for higher availability <br><br>**References:** <br>[Create redundancy for HA](https://cloud.google.com/architecture/framework/reliability/design-scale-high-availability)                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               	| Does your organization require you to create buckets in dual-region or multi-region?                                                                                       	| Systems with high reliability needs must have no single points of failure, and their resources must be replicated across multiple failure domains.  A failure domain is a pool of resources that can fail independently, such as a VM instance, zone, or region.  When you replicate across failure domains, you get a higher aggregate level of availability than individual instances could achieve. 	|           TBD           	|
| GCS-009 	|          TBD          	| All ingress and egress connection should be allowed using HTTPS only.  HTTP traffic should be rejected.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               	|                                                                                                                                                                            	|                                                                                                                                                                                                                                                                                                                                                                                                        	|           TBD           	|
| GCS-010 	|          TBD          	| To prevent data exfilitration, buckets with consumer data/PI/highly confidential data should be behind VPC Service Controls                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           	|                                                                                                                                                                            	|                                                                                                                                                                                                                                                                                                                                                                                                        	|           TBD           	|
